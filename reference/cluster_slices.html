<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Find slice locations based on cluster centers of mass in a 3D brain image — cluster_slices • ggbrain</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Find slice locations based on cluster centers of mass in a 3D brain image — cluster_slices"><meta name="description" content="This function identifies connected clusters in a brain image (after applying
an optional definition/contrast) and returns slice coordinates corresponding to the
center of mass of each cluster. This is useful for automatically selecting slices
that display the most relevant activation clusters."><meta property="og:description" content="This function identifies connected clusters in a brain image (after applying
an optional definition/contrast) and returns slice coordinates corresponding to the
center of mass of each cluster. This is useful for automatically selecting slices
that display the most relevant activation clusters."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggbrain</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/ggbrain_aesthetics.html">Aesthetic refinements of ggbrain plots</a></li>
    <li><a class="dropdown-item" href="../articles/ggbrain_introduction.html">Introduction to ggbrain</a></li>
    <li><a class="dropdown-item" href="../articles/ggbrain_labels.html">Working with annotations and labels in ggbrain</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/michaelhallquist/ggbrain/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Find slice locations based on cluster centers of mass in a 3D brain image</h1>
      <small class="dont-index">Source: <a href="https://github.com/michaelhallquist/ggbrain/blob/main/R/cluster_slices.R" class="external-link"><code>R/cluster_slices.R</code></a></small>
      <div class="d-none name"><code>cluster_slices.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function identifies connected clusters in a brain image (after applying
an optional definition/contrast) and returns slice coordinates corresponding to the
center of mass of each cluster. This is useful for automatically selecting slices
that display the most relevant activation clusters.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cluster_slices</span><span class="op">(</span></span>
<span>  images <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  layer <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  definition <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nclusters <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  min_clust_size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  plane <span class="op">=</span> <span class="st">"axial"</span>,</span>
<span>  nn <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  outline <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  outline_color <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outline_size <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  outline_scale <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outline_show_legend <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-images">images<a class="anchor" aria-label="anchor" href="#arg-images"></a></dt>
<dd><p>A ggbrain_images object or a named character vector of image file paths.
Required for computing cluster locations.</p></dd>


<dt id="arg-layer">layer<a class="anchor" aria-label="anchor" href="#arg-layer"></a></dt>
<dd><p>The name of a geom_brain layer whose definition should be used for clustering.
Mutually exclusive with <code>definition</code>. When using <code>layer</code>, the function returns
a deferred specification that is resolved during rendering when layer definitions are available.</p></dd>


<dt id="arg-definition">definition<a class="anchor" aria-label="anchor" href="#arg-definition"></a></dt>
<dd><p>A definition string (same syntax as geom_brain) specifying the image/contrast
to use for clustering. Examples: <code>"overlay"</code>, <code>"overlay[overlay &gt; 2.5]"</code>,
<code>"overlay[abs(overlay) &gt; 2.5]"</code>. Mutually exclusive with <code>layer</code>.</p></dd>


<dt id="arg-nclusters">nclusters<a class="anchor" aria-label="anchor" href="#arg-nclusters"></a></dt>
<dd><p>Maximum number of clusters to return slices for. Clusters are sorted by
size (descending), and the top <code>nclusters</code> are selected. Default: 10</p></dd>


<dt id="arg-min-clust-size">min_clust_size<a class="anchor" aria-label="anchor" href="#arg-min-clust-size"></a></dt>
<dd><p>Minimum cluster size in voxels. Clusters smaller than this are ignored. Default: 1</p></dd>


<dt id="arg-plane">plane<a class="anchor" aria-label="anchor" href="#arg-plane"></a></dt>
<dd><p>The plane for slice selection: <code>"axial"</code> (z), <code>"sagittal"</code> (x),
or <code>"coronal"</code> (y). Default: <code>"axial"</code></p></dd>


<dt id="arg-nn">nn<a class="anchor" aria-label="anchor" href="#arg-nn"></a></dt>
<dd><p>Neighborhood connectivity for defining clusters. Must be 1, 2, or 3:</p><ul><li><p><code>nn=1</code>: 6-connectivity (faces touching only)</p></li>
<li><p><code>nn=2</code>: 18-connectivity (faces and edges touching)</p></li>
<li><p><code>nn=3</code>: 26-connectivity (faces, edges, and corners touching)</p></li>
</ul><p>Default: 3 (most inclusive)</p></dd>


<dt id="arg-outline">outline<a class="anchor" aria-label="anchor" href="#arg-outline"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, a cluster outline mask is generated and automatically
added as a <code><a href="geom_outline.html">geom_outline()</a></code> layer during rendering. Default: <code>FALSE</code></p></dd>


<dt id="arg-outline-color">outline_color<a class="anchor" aria-label="anchor" href="#arg-outline-color"></a></dt>
<dd><p>A single color string for all cluster outlines. If <code>NULL</code> (default),
distinct colors are assigned to each cluster using the "Dark 3" HCL palette. Mutually
exclusive with <code>outline_scale</code>.</p></dd>


<dt id="arg-outline-size">outline_size<a class="anchor" aria-label="anchor" href="#arg-outline-size"></a></dt>
<dd><p>Integer specifying the outline thickness in pixels. Default: 1</p></dd>


<dt id="arg-outline-scale">outline_scale<a class="anchor" aria-label="anchor" href="#arg-outline-scale"></a></dt>
<dd><p>A ggplot2 scale object (e.g., <code>scale_fill_manual</code>) to use for
cluster outline colors. Mutually exclusive with <code>outline_color</code>.</p></dd>


<dt id="arg-outline-show-legend">outline_show_legend<a class="anchor" aria-label="anchor" href="#arg-outline-show-legend"></a></dt>
<dd><p>Logical. Whether to show a legend for cluster outlines. If
<code>NULL</code> (default), a legend is shown when multiple clusters exist.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>images</code> is provided along with <code>definition</code>, returns a character vector
of slice coordinates (e.g., <code>c("z = 10.5", "z = -3.2")</code>) suitable for passing to
<code><a href="slices.html">slices()</a></code>. If <code>layer</code> is specified or <code>images</code> is not provided, returns
a deferred specification object (class <code>"cluster_slices_spec"</code>) that will be resolved
during the ggbrain rendering pipeline.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs 3D connected component labeling on the thresholded/masked image
to identify distinct clusters. For each cluster meeting the minimum size criterion,
the center of mass is computed. Slices are then selected at the center of mass
coordinates along the specified plane.</p>
<p>When <code>outline = TRUE</code>, a thin outline mask is also generated for the selected clusters.
This outline can be automatically added as a <code><a href="geom_outline.html">geom_outline()</a></code> layer during rendering so
that clusters are highlighted on each slice. By default, distinct colors are assigned to each
cluster using a categorical palette, but a single <code>outline_color</code> or a custom vector of
colors can also be provided. The outline thickness can be controlled via
<code>outline_size</code>.</p>
<p>The neighborhood connectivity parameter (<code>nn</code>) controls how voxels are considered
connected:</p><ul><li><p><code>nn=1</code> (6-connectivity): Only voxels sharing a face are connected</p></li>
<li><p><code>nn=2</code> (18-connectivity): Voxels sharing a face or edge are connected</p></li>
<li><p><code>nn=3</code> (26-connectivity): Voxels sharing a face, edge, or corner are connected</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span>  <span class="co"># Using a definition string directly</span></span></span>
<span class="r-in"><span>  <span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"mni_template_2009c_2mm.nii.gz"</span>, package <span class="op">=</span> <span class="st">"ggbrain"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">overlay</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"pe_ptfce_fwep_0.05_2mm.nii.gz"</span>, package <span class="op">=</span> <span class="st">"ggbrain"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">t1</span>, overlay <span class="op">=</span> <span class="va">overlay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="slices.html">slices</a></span><span class="op">(</span><span class="fu">cluster_slices</span><span class="op">(</span></span></span>
<span class="r-in"><span>      images <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>overlay <span class="op">=</span> <span class="va">overlay</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      definition <span class="op">=</span> <span class="st">"overlay[abs(overlay) &gt; 2.5]"</span>,</span></span>
<span class="r-in"><span>      nclusters <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>      min_clust_size <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>      plane <span class="op">=</span> <span class="st">"axial"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="geom_brain.html">geom_brain</a></span><span class="op">(</span><span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"overlay[abs(overlay) &gt; 2.5]"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># Or defer resolution until render time (images from ggbrain pipeline)</span></span></span>
<span class="r-in"><span>  <span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">t1</span>, overlay <span class="op">=</span> <span class="va">overlay</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="slices.html">slices</a></span><span class="op">(</span><span class="fu">cluster_slices</span><span class="op">(</span></span></span>
<span class="r-in"><span>      definition <span class="op">=</span> <span class="st">"overlay[abs(overlay) &gt; 2.5]"</span>,</span></span>
<span class="r-in"><span>      nclusters <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span>    <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="geom_brain.html">geom_brain</a></span><span class="op">(</span><span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"overlay[abs(overlay) &gt; 2.5]"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Hallquist.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

