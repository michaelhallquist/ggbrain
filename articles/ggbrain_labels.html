<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working with annotations and labels in ggbrain • ggbrain</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with annotations and labels in ggbrain">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggbrain</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ggbrain_aesthetics.html">Aesthetic refinements of ggbrain plots</a></li>
    <li><a class="dropdown-item" href="../articles/ggbrain_introduction.html">Introduction to ggbrain</a></li>
    <li><a class="dropdown-item" href="../articles/ggbrain_labels.html">Working with annotations and labels in ggbrain</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/michaelhallquist/ggbrain/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Working with annotations and labels in ggbrain</h1>
                        <h4 data-toc-skip class="author">Michael
Hallquist</h4>
            
            <h4 data-toc-skip class="date">26 Oct 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/michaelhallquist/ggbrain/blob/main/vignettes/ggbrain_labels.Rmd" class="external-link"><code>vignettes/ggbrain_labels.Rmd</code></a></small>
      <div class="d-none name"><code>ggbrain_labels.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="categorical-images-in-ggbrain">Categorical images in ggbrain<a class="anchor" aria-label="anchor" href="#categorical-images-in-ggbrain"></a>
</h2>
<p>Many visualizations of brain data rely on continuous-valued images
containing intensities or statistics. For example, we might wish to
visualize the <em>z</em>-statistics of a general linear model. These are
classic “statistical parametric maps.”</p>
<p>Yet, many images contain integers whose values represent a priori
regions of interest or clusters identified using familywise error
correction methods. Brain atlases are a common example of integer-valued
images. Here, we demonstrate the visualization of a cortical
parcellation developed by Schaefer and colleagues (2018).</p>
<p>Schaefer, A., Kong, R., Gordon, E. M., Laumann, T. O., Zuo, X.-N.,
Holmes, A. J., Eickhoff, S. B., &amp; Yeo, B. T. T. (2018). Local-global
parcellation of the human cerebral cortex from intrinsic functional
connectivity MRI. <em>Cerebral Cortex, 28</em>, 3095-3114.</p>
<p>This version of the atlas contains 200 cortical parcels (in the
paper, they show 100-1000 parcels).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schaefer_img</span> <span class="op">&lt;-</span> <span class="fu">readNifti</span><span class="op">(</span><span class="va">schaefer200_atlas_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">schaefer_img</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 201</span></span></code></pre>
<p>At a basic level, we can visualize this image in the same way as
continuous images, as described in the <a href="ggbrain_introduction.html">ggbrain introduction</a> document.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_file</span>, atlas <span class="op">=</span> <span class="va">schaefer200_atlas_file</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z = 30"</span>, <span class="st">"z=40"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span>, name<span class="op">=</span><span class="st">"Anatomical"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas"</span>, name <span class="op">=</span> <span class="st">"Parcel number"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>As we can see, however, the continuous values represent discrete
parcels in the atlas. Thus, we may wish to use a categorical/discrete
color scale to visualize things. As with base <code>ggplot2</code>, we
can wrap the fill column in <code>factor</code> to force conversion to a
discrete data type.</p>
<p>Note that the numeric value of any image in a <code>ggbrain</code>
object is always called <code>value</code>. And thus, for
<code>geom_brain</code> and <code>geom_outline</code> objects, the
default aesthetic mapping is <code>aes(fill=value)</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_file</span>, atlas <span class="op">=</span> <span class="va">schaefer200_atlas_file</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z = 30"</span>, <span class="st">"z=40"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas"</span>, name <span class="op">=</span> <span class="st">"Parcel number"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_hue</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 3207 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 2912 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>This is a lot to take in! It’s not especially easy to resolve 70+
parcels by their color…</p>
<p>We could use use subsetting syntax in the layer definition to reduce
the number of parcels. For example, perhaps we’re interested in just the
first 20.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_file</span>, atlas <span class="op">=</span> <span class="va">schaefer200_atlas_file</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z = 30"</span>, <span class="st">"z=40"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas[atlas &lt; 20]"</span>, name <span class="op">=</span> <span class="st">"Parcel number"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_hue</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 5688 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 5755 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>This is more manageable, though uninspiring.</p>
</div>
<div class="section level2">
<h2 id="mapping-image-values-to-labels">Mapping image values to labels<a class="anchor" aria-label="anchor" href="#mapping-image-values-to-labels"></a>
</h2>
<p>Categorical images typically contain one integer value at each voxel.
The values could be the cluster number from a clusterization procedure
(e.g., AFNI’s 3dClusterize), a region of interest from a
meta-analytically derived mask (e.g., NeuroSynth), or an atlas value
from a stereotaxic atlas (e.g., the Schaefer atlas used here).</p>
<p>Regardless, the conceptual view is that each integer in the image
represents a category of interest. Moreover, we may wish to label these
categories with more descriptive labels, not simply the integer value.
Thus, integers in an image give us the locations of regions to be
labeled, while a separate data table provides the integers &lt;-&gt;
labels mapping.</p>
<p>Our labels could be region names, intrinsic networks, or other
features we wish to highlight on the display. Regardless, there are two
major ways in which labels can be displayed on a <code>ggbrain</code>
plot: mapping the labels to colors displayed in the legend or adding
text annotations at the locations of the regions. We will review these
two approaches in turn.</p>
<p>First, however, let’s see how we tell <code>ggbrain</code> to merge
labels with an integer-valued NIfTI image. Above, we read in a CSV file
containing labels for regions in the Schaefer 200 parcellation. These
were generated in part using AFNI’s whereami command with the centroids
of each region serving as an input. This gives us automated labels that
we may wish to display on the plot. The CSV also contains a columns
called <code>network</code> that refers to the network mapping to the
Yeo 2011 7-network parcellation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">schaefer200_atlas_labels</span>, n<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="6%">
<col width="25%">
<col width="12%">
<col width="23%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="right">roi_num</th>
<th align="left">hemi</th>
<th align="right">x</th>
<th align="right">y</th>
<th align="right">z</th>
<th align="left">network</th>
<th align="left">MNI_Glasser_HCP_v1.0</th>
<th align="left">Brainnetome_1.0</th>
<th align="left">CA_ML_18_MNI</th>
<th align="left">schaefer_region</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">L</td>
<td align="right">-24</td>
<td align="right">-53</td>
<td align="right">-9</td>
<td align="left">Vis</td>
<td align="left">L_VentroMedial_Visual_Area_2</td>
<td align="left">rLinG_left</td>
<td align="left">Left Lingual Gyrus</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">L</td>
<td align="right">-24</td>
<td align="right">-76</td>
<td align="right">-13</td>
<td align="left">Vis</td>
<td align="left">L_Eighth_Visual_Area</td>
<td align="left">A37mv_left</td>
<td align="left">Left Fusiform Gyrus</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">L</td>
<td align="right">-43</td>
<td align="right">-70</td>
<td align="right">-9</td>
<td align="left">Vis</td>
<td align="left">L_Area_PH</td>
<td align="left">A37lv_left</td>
<td align="left">Left Inferior Occipital Gyrus</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">L</td>
<td align="right">-10</td>
<td align="right">-66</td>
<td align="right">-5</td>
<td align="left">Vis</td>
<td align="left">L_Third_Visual_Area</td>
<td align="left">rLinG_left</td>
<td align="left">Left Lingual Gyrus</td>
<td align="left">4</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">L</td>
<td align="right">-25</td>
<td align="right">-94</td>
<td align="right">-11</td>
<td align="left">Vis</td>
<td align="left">L_Third_Visual_Area</td>
<td align="left">iOccG_left</td>
<td align="left">Left Inferior Occipital Gyrus</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">L</td>
<td align="right">-14</td>
<td align="right">-44</td>
<td align="right">-3</td>
<td align="left">Vis</td>
<td align="left">L_PreSubiculum</td>
<td align="left">A23v_left</td>
<td align="left">Left Lingual Gyrus</td>
<td align="left">6</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">L</td>
<td align="right">-5</td>
<td align="right">-92</td>
<td align="right">-3</td>
<td align="left">Vis</td>
<td align="left">L_Primary_Visual_Cortex</td>
<td align="left">cCunG_left</td>
<td align="left">Left Calcarine Gyrus</td>
<td align="left">7</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="left">L</td>
<td align="right">-46</td>
<td align="right">-71</td>
<td align="right">8</td>
<td align="left">Vis</td>
<td align="left">L_Medial_Superior_Temporal_Area</td>
<td align="left">V5/MT+_left</td>
<td align="left">Left Middle Occipital Gyrus</td>
<td align="left">8</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="left">L</td>
<td align="right">-23</td>
<td align="right">-96</td>
<td align="right">6</td>
<td align="left">Vis</td>
<td align="left">L_Third_Visual_Area</td>
<td align="left">OPC_left</td>
<td align="left">Left Middle Occipital Gyrus</td>
<td align="left">9</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="left">L</td>
<td align="right">-12</td>
<td align="right">-70</td>
<td align="right">7</td>
<td align="left">Vis</td>
<td align="left">L_Primary_Visual_Cortex</td>
<td align="left">vmPOS_left</td>
<td align="left">Left Calcarine Gyrus</td>
<td align="left">10</td>
</tr>
</tbody>
</table>
<p>The structure of this <code>data.frame</code> is relatively flexible.
The primary requirement is that it contain a column called
<code>value</code> that maps to the numeric value of the corresponding
NIfTI image of interest. Here, we have a column called
<code>roi_num</code> that maps to the integer values in the mask. So, we
need to rename it to <code>value</code> for <code>ggbrain</code> to
accept it as a lookup table for labeling.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schaefer200_atlas_labels</span> <span class="op">&lt;-</span> <span class="va">schaefer200_atlas_labels</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">roi_num</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have this, we can add the labels to the corresponding
NIfTI image. This step does not necessarily change the plot, but instead
gives us access to additional columns that we can use for labeling.</p>
<p>We use the <code>labels</code> argument with the <code>images</code>
function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_file</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>atlas <span class="op">=</span> <span class="va">schaefer200_atlas_file</span><span class="op">)</span>, labels<span class="op">=</span><span class="va">schaefer200_atlas_labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z = 30"</span>, <span class="st">"z=40"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas[atlas &lt; 20]"</span>, name <span class="op">=</span> <span class="st">"Parcel number"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_hue</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in melt.data.table(ll_df, measure.vars = label_columns, variable.name =</span></span>
<span><span class="co">## ".label_col", : 'measure.vars' [hemi, network, MNI_Glasser_HCP_v1.0,</span></span>
<span><span class="co">## Brainnetome_1.0, ...] are not all of the same type. By order of hierarchy, the</span></span>
<span><span class="co">## molten data value column will be of type 'character'. All measure variables not</span></span>
<span><span class="co">## of type 'character' will be coerced too. Check DETAILS in ?melt.data.table for</span></span>
<span><span class="co">## more on coercion.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 5688 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 5755 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Notice that I have broken up the addition of images to the object
into two <code>images</code> steps. This allows for an unambiguous
mapping of the labels to the singular NIfTI. An alternative is to use a
named list of the sort:
<code>images(c(im1=file1, im2=file2), labels=list(im2=im2labels))</code>.</p>
<p>Also, the plot above is identical to our earlier plot. This is
because we have mapped the fill to the numeric value, not another column
in the labels file.</p>
<p>How about we use the labels from the Eickhoff-Zilles macro labels
from N27?</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas[atlas &lt; 20]"</span>, name <span class="op">=</span> <span class="st">"Eickhoff-Zilles Label"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">CA_ML_18_MNI</span><span class="op">)</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_hue</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 5688 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 5755 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Notice how we went from four colors (one per number) in the previous
plot to three labels here. Why did this happen? The labels for the four
regions were not unique in the lookup atlas.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schaefer200_atlas_labels</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">value</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">13</span>, <span class="fl">14</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">value</span>, <span class="va">CA_ML_18_MNI</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   value                  CA_ML_18_MNI</span></span>
<span><span class="co">## 1    12                   Left Cuneus</span></span>
<span><span class="co">## 2    13                   Left Cuneus</span></span>
<span><span class="co">## 3    14 Left Superior Occipital Gyrus</span></span>
<span><span class="co">## 4    18       Left Rolandic Operculum</span></span></code></pre>
<p>This highlights a useful point: there can be a one-to-many mapping
between labels and unique integer values in the NIfTI image. Indeed,
this is often an explicit goal. For example, what if we want to see the
Yeo 7 networks assignments for the nodes on these two slices?</p>
<p>(Note that I’m removing the filter <code>atlas &lt; 20</code> here to
let all of the parcels on these slices get to play.)</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas"</span>, name <span class="op">=</span> <span class="st">"Yeo 7 Assignment"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">network</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 3207 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 2912 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>If we do not provide a color palette using the
<code>fill_scale</code> argument, it defaults to <a href="https://colorbrewer2.org/#type=qualitative&amp;scheme=Set3&amp;n=12" class="external-link">ColorBrewer’s
“Set3”</a>, <code>scale_fill_brewer(palette = "Set3")</code>.</p>
<p>What if we wanted to use the same coloration as in the original Yeo
et al. 2011 paper? These colors are provided in the
Yeo2011_7Networks_ColorLUT.txt file from <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/CorticalParcellation_Yeo2011" class="external-link">Freesurfer</a>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeo_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Yeo2011_7Networks_ColorLUT.txt"</span>, package <span class="op">=</span> <span class="st">"ggbrain"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"index"</span>, <span class="st">"name"</span>, <span class="st">"r"</span>, <span class="st">"g"</span>, <span class="st">"b"</span>, <span class="st">"zero"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">slice</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert RGB to hex. Also, using a named set of colors with scale_fill_manual ensures accurate value -&gt; color mapping</span></span>
<span><span class="va">yeo7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue_data</a></span><span class="op">(</span><span class="va">yeo_colors</span>, <span class="st">"{sprintf('#%.2x%.2x%.2x', r, g, b)}"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Vis"</span>, <span class="st">"SomMot"</span>, <span class="st">"DorsAttn"</span>, <span class="st">"SalVentAttn"</span>, <span class="st">"Limbic"</span>, <span class="st">"Cont"</span>, <span class="st">"Default"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas"</span>, name <span class="op">=</span> <span class="st">"Yeo 7 Assignment"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">network</span><span class="op">)</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">yeo7</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 3207 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 2912 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="combining-filled-areas-with-outlines">Combining filled areas with outlines<a class="anchor" aria-label="anchor" href="#combining-filled-areas-with-outlines"></a>
</h2>
<p>It may be useful to map some labels to the fill of an area and to
draw outlines around areas using another label. For example, if regions
are nested within networks, we might want to outline the networks with a
certain color while having separate colors for regions. This can be
achieved by adding a <code>geom_outline</code> layer for networks
alongside a <code>geom_brain</code> layer for regions.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"DAN Region := atlas[atlas.network == 'DorsAttn']"</span>, </span>
<span>             mapping<span class="op">=</span><span class="fu">aes</span><span class="op">(</span>fill<span class="op">=</span><span class="va">CA_ML_18_MNI</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/geom_outline.html">geom_outline</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas"</span>, name <span class="op">=</span> <span class="st">"Yeo 7 Assignment"</span>,</span>
<span>               mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>outline <span class="op">=</span> <span class="va">network</span><span class="op">)</span>, </span>
<span>               outline_scale <span class="op">=</span> <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">yeo7</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 5614 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 33909 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 5468 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 33738 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>This admittedly a busy figure! But you get the idea of how to combine
outlines and fills for these categorical images.</p>
</div>
<div class="section level2">
<h2 id="combining-quantitative-layers-with-labels">Combining quantitative layers with labels<a class="anchor" aria-label="anchor" href="#combining-quantitative-layers-with-labels"></a>
</h2>
<p>Another common use of atlases (and other categorical images) is to
contextualize a pattern of activity from a voxelwise analysis in terms
of its overlap with atlas parcels/regions. This can be achieved by
combining a quantitative layer in ggbrain with a categorical one. Here,
we plot the pattern of activity associated with absolute prediction
errors from a study of reinforcement learning and overlay major regions
of the Dorsal Attention Network, namely posterior parietal cortex (PPC),
premotor (including frontal eye fields), and middle temporal visual area
(MT+).</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first, divide relevant DAN parcels into groups</span></span>
<span><span class="va">dan_labels</span> <span class="op">&lt;-</span> <span class="va">schaefer200_atlas_labels</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">network</span><span class="op">==</span><span class="st">"DorsAttn"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    dan_group<span class="op">=</span><span class="fu">case_when</span><span class="op">(</span></span>
<span>      <span class="va">value</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">31</span>, <span class="fl">32</span>, <span class="fl">135</span>, <span class="fl">136</span><span class="op">)</span> <span class="op">~</span> <span class="st">"MT+"</span>,</span>
<span>      <span class="va">value</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">33</span><span class="op">:</span><span class="fl">40</span>, <span class="fl">137</span><span class="op">:</span><span class="fl">144</span><span class="op">)</span> <span class="op">~</span> <span class="st">"PPC"</span>,</span>
<span>      <span class="va">value</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">41</span><span class="op">:</span><span class="fl">43</span>, <span class="fl">145</span><span class="op">:</span><span class="fl">147</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Premotor"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">abspe_gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span>bg_color <span class="op">=</span> <span class="st">"gray90"</span>, text_color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>                    base_size <span class="op">=</span> <span class="fl">16</span>, title <span class="op">=</span> <span class="st">"Absolute reward prediction error\n(feedback phase)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_file</span>, overlay<span class="op">=</span><span class="va">abspe_overlay_3mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>atlas <span class="op">=</span> <span class="va">schaefer200_atlas_file</span><span class="op">)</span>, labels<span class="op">=</span><span class="va">dan_labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x = -42"</span>, <span class="st">"z = 49"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"overlay"</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_gradient</span><span class="op">(</span><span class="st">"z"</span>, low<span class="op">=</span><span class="st">"#006837"</span>, high<span class="op">=</span><span class="st">"#d9f0a3"</span><span class="op">)</span>, </span>
<span>             breaks <span class="op">=</span> <span class="fu"><a href="../reference/range_breaks.html">range_breaks</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_outline.html">geom_outline</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas"</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>outline <span class="op">=</span> <span class="va">dan_group</span><span class="op">)</span>, </span>
<span>               outline_scale <span class="op">=</span> <span class="fu">scale_fill_brewer</span><span class="op">(</span><span class="st">"DAN"</span>, palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/annotate_coordinates.html">annotate_coordinates</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"black"</span>, x <span class="op">=</span> <span class="st">"right"</span>, y <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">abspe_gg</span><span class="op">)</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 21908 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 16119 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/dan_overlay-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="adding-annotations">Adding annotations<a class="anchor" aria-label="anchor" href="#adding-annotations"></a>
</h2>
<p>In addition to plotting categorical images, we often wish to annotate
our plots with custom text in the margin or labels overlaid on certain
areas. ggbrain provides the <code>annotate_slice</code> function, which
allows you to add a custom annotation to one panel. This function
attaches to <code><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">ggplot2::annotate</a></code> such that any of its settings
apply to <code>annotate_slice</code> as well. Relative to typical
annotations in ggplot2, with <code>ggbrain</code>, we must also provide
x and y positions on the panel, as well the slice to which the
annotation should be added.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ann</span> <span class="op">&lt;-</span> <span class="va">abspe_gg</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/annotate_slice.html">annotate_slice</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">20</span>, y<span class="op">=</span><span class="fl">20</span>, slice_index<span class="op">=</span><span class="fl">1</span>, geom<span class="op">=</span><span class="st">"text"</span>, label<span class="op">=</span><span class="st">"slice1"</span>, color<span class="op">=</span><span class="st">"gray40"</span>, size<span class="op">=</span><span class="fl">11</span>, hjust<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/annotate_slice.html">annotate_slice</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">20</span>, y<span class="op">=</span><span class="fl">40</span>, slice_index<span class="op">=</span><span class="fl">2</span>, geom<span class="op">=</span><span class="st">"text"</span>, label<span class="op">=</span><span class="st">"slice2"</span>, color<span class="op">=</span><span class="st">"gray40"</span>, size<span class="op">=</span><span class="fl">11</span>, hjust<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ann</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 21908 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 16119 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>If numbers are provided for the x and y positions, these specify that
the annotation should be placed at those coordinates in the pixel/voxel
matrix. This may not be especially intuitive since we often don’t think
about things in the matrix (aka “ijk” space) of the NIfTI. Here, our
NIfTIs have dimensions: 97, 115, 97.</p>
<p>Alternatively, we can use the shorthand of “left” and “right” for x
coordinates and “top” and “bottom” for y coordinates. The shorthand of
“middle” also works in x and y.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ann</span> <span class="op">&lt;-</span> <span class="va">abspe_gg</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/annotate_slice.html">annotate_slice</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"left"</span>, y<span class="op">=</span><span class="st">"top"</span>, slice_index<span class="op">=</span><span class="fl">1</span>, geom<span class="op">=</span><span class="st">"text"</span>, label<span class="op">=</span><span class="st">"slice1"</span>, color<span class="op">=</span><span class="st">"gray40"</span>, size<span class="op">=</span><span class="fl">11</span>, hjust<span class="op">=</span><span class="fl">0</span>, vjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/annotate_slice.html">annotate_slice</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"right"</span>, y<span class="op">=</span><span class="st">"bottom"</span>, slice_index<span class="op">=</span><span class="fl">2</span>, geom<span class="op">=</span><span class="st">"text"</span>, label<span class="op">=</span><span class="st">"slice2"</span>, color<span class="op">=</span><span class="st">"gray40"</span>, size<span class="op">=</span><span class="fl">11</span>, hjust<span class="op">=</span><span class="fl">1</span>, vjust<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ann</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 21908 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 16119 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Finally, we can use quantiles/percentiles along each axis to position
things in relative space.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ann</span> <span class="op">&lt;-</span> <span class="va">abspe_gg</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/annotate_slice.html">annotate_slice</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"q30"</span>, y<span class="op">=</span><span class="st">"q60"</span>, slice_index<span class="op">=</span><span class="fl">1</span>, geom<span class="op">=</span><span class="st">"text"</span>, label<span class="op">=</span><span class="st">"slice1"</span>, color<span class="op">=</span><span class="st">"gray40"</span>, size<span class="op">=</span><span class="fl">11</span>, hjust<span class="op">=</span><span class="fl">0</span>, vjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/annotate_slice.html">annotate_slice</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"q35"</span>, y<span class="op">=</span><span class="st">"q70"</span>, slice_index<span class="op">=</span><span class="fl">2</span>, geom<span class="op">=</span><span class="st">"text"</span>, label<span class="op">=</span><span class="st">"slice2"</span>, color<span class="op">=</span><span class="st">"gray40"</span>, size<span class="op">=</span><span class="fl">11</span>, hjust<span class="op">=</span><span class="fl">0.5</span>, vjust<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ann</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 21908 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 16119 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>As with <code>annotate</code> in ggplot2, the
<code>annotate_slice</code> function can also be used to add other
geometric shapes such as rectangles or points. For example, we could
highlight the occipital region here.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ann</span> <span class="op">&lt;-</span> <span class="va">abspe_gg</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/annotate_slice.html">annotate_slice</a></span><span class="op">(</span>xmin<span class="op">=</span><span class="st">"q0"</span>, xmax<span class="op">=</span><span class="st">"q38"</span>, ymin<span class="op">=</span><span class="st">"q25"</span>, ymax<span class="op">=</span><span class="st">"q59"</span>, slice_index<span class="op">=</span><span class="fl">1</span>, geom<span class="op">=</span><span class="st">"rect"</span>, </span>
<span>                 color<span class="op">=</span><span class="st">"blue"</span>, fill<span class="op">=</span><span class="st">"transparent"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ann</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Unknown or uninitialised column: `label`.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 21908 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 16119 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="adding-labels-systematically">Adding labels systematically<a class="anchor" aria-label="anchor" href="#adding-labels-systematically"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Hallquist.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
