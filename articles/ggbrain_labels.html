<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ggbrain">
<title>Working with annotations and labels in ggbrain • ggbrain</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working with annotations and labels in ggbrain">
<meta property="og:description" content="ggbrain">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ggbrain</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ggbrain_aesthetics.html">Aesthetic refinements of ggbrain plots</a>
    <a class="dropdown-item" href="../articles/ggbrain_introduction.html">Introduction to ggbrain</a>
    <a class="dropdown-item" href="../articles/ggbrain_labels.html">Working with annotations and labels in ggbrain</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/michaelhallquist/ggbrain/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Working with annotations and labels in ggbrain</h1>
                        <h4 data-toc-skip class="author">Michael
Hallquist</h4>
            
            <h4 data-toc-skip class="date">26 Oct 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/michaelhallquist/ggbrain/blob/HEAD/vignettes/ggbrain_labels.Rmd" class="external-link"><code>vignettes/ggbrain_labels.Rmd</code></a></small>
      <div class="d-none name"><code>ggbrain_labels.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="categorical-images-in-ggbrain">Categorical images in ggbrain<a class="anchor" aria-label="anchor" href="#categorical-images-in-ggbrain"></a>
</h2>
<p>Many visualizations of brain data rely on continuous-valued images
containing intensities or statistics. For example, we might wish to
visualize the <em>z</em>-statistics of a general linear model.</p>
<p>Yet, many images contain integers whose values represent a priori
regions of interest or clusters identified using familywise error
correction methods. Brain atlases are a common example of integer-valued
images. Here, we demonstrate the cortical parcellation developed by
Schaefer and colleagues (2018).</p>
<p>Schaefer, A., Kong, R., Gordon, E. M., Laumann, T. O., Zuo, X.-N.,
Holmes, A. J., Eickhoff, S. B., &amp; Yeo, B. T. T. (2018). Local-global
parcellation of the human cerebral cortex from intrinsic functional
connectivity MRI. <em>Cerebral Cortex, 28</em>, 3095-3114.</p>
<p>This version of the atlas contains 200 cortical parcels (in the
paper, they show 100-1000 parcels).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schaefer_img</span> <span class="op">&lt;-</span> <span class="fu">readNifti</span><span class="op">(</span><span class="va">schaefer200_atlas_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">schaefer_img</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   [1]   0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17</span></span>
<span><span class="co">##  [19]  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35</span></span>
<span><span class="co">##  [37]  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53</span></span>
<span><span class="co">##  [55]  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71</span></span>
<span><span class="co">##  [73]  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89</span></span>
<span><span class="co">##  [91]  90  91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107</span></span>
<span><span class="co">## [109] 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125</span></span>
<span><span class="co">## [127] 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143</span></span>
<span><span class="co">## [145] 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161</span></span>
<span><span class="co">## [163] 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179</span></span>
<span><span class="co">## [181] 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197</span></span>
<span><span class="co">## [199] 198 199 200</span></span></code></pre>
<p>At a basic level, we can visualize this image in the same way as
continuous images, as described in [ggbrain_introduction.html].</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_file</span>, atlas <span class="op">=</span> <span class="va">schaefer200_atlas_file</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z = 30"</span>, <span class="st">"z=40"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas"</span>, name <span class="op">=</span> <span class="st">"Parcel number"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>As we can see, however, the continuous values represent discrete
parcels in the atlas. Thus, we may wish to use a categorical/discrete
color scale to visualize things. As with base <code>ggplot2</code>, we
can wrap the fill column in <code>factor</code> to force conversion to a
discrete data type.</p>
<p>Note that the numeric value of any image in a <code>ggbrain</code>
object is always called <code>value</code>. And thus, for
<code>geom_brain</code> and <code>geom_outline</code> objects, the
default aesthetic mapping is <code>aes(fill=value)</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_file</span>, atlas <span class="op">=</span> <span class="va">schaefer200_atlas_file</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z = 30"</span>, <span class="st">"z=40"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas"</span>, name <span class="op">=</span> <span class="st">"Parcel number"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_hue</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 3855 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 3707 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>This is a lot to take in! It’s not especially easy to resolve 70+
parcels by their color…</p>
<p>We could use use subsetting syntax in the layer definition to reduce
the number of parcels. For example, perhaps we’re interested in just the
first 20.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_file</span>, atlas <span class="op">=</span> <span class="va">schaefer200_atlas_file</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z = 30"</span>, <span class="st">"z=40"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas[atlas &lt; 20]"</span>, name <span class="op">=</span> <span class="st">"Parcel number"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_hue</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 4943 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 4972 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>This is more manageable, though uninspiring.</p>
</div>
<div class="section level2">
<h2 id="mapping-image-values-to-labels">Mapping image values to labels<a class="anchor" aria-label="anchor" href="#mapping-image-values-to-labels"></a>
</h2>
<p>Categorical images typically contain one integer value at each voxel.
The values could be the cluster number from a clusterization procedure
(e.g., AFNI’s 3dClusterize), a region of interest from a
meta-analytically derived mask (e.g., NeuroSynth), or an atlas value
from a stereotaxic atlas (e.g., the Schaefer atlas used here).</p>
<p>Regardless, the conceptual view is that each integer in the image
represents a category of interest. Moreover, we may wish to label these
categories with more descriptive labels, not simply the integer value.
Thus, integers in an image give us the locations of regions to be
labeled, while a separate data table provides the integers &lt;-&gt;
labels mapping.</p>
<p>Our labels could be region names, intrinsic networks, or other
features we wish to highlight on the display. Regardless, there are two
major ways in which labels can be displayed on a <code>ggbrain</code>
plot: mapping the labels to colors displayed in the legend or adding
text annotations at the locations of the regions. We will review these
two approaches in turn.</p>
<p>First, however, let’s see how we tell <code>ggbrain</code> to merge
labels with an integer-valued NIfTI image. Above, we read in a CSV file
containing labels for regions in the Schaefer 200 parcellation. These
were generated in part using AFNI’s whereami command with the centroids
of each region serving as an input. This gives us automated labels that
we may wish to display on the plot. The CSV also contains a columns
called <code>network</code> that refers to the network mapping to the
Yeo 2011 7-network parcellation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">schaefer200_atlas_labels</span>, n<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="6%">
<col width="25%">
<col width="12%">
<col width="23%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="right">roi_num</th>
<th align="left">hemi</th>
<th align="right">x</th>
<th align="right">y</th>
<th align="right">z</th>
<th align="left">network</th>
<th align="left">MNI_Glasser_HCP_v1.0</th>
<th align="left">Brainnetome_1.0</th>
<th align="left">CA_ML_18_MNI</th>
<th align="left">schaefer_region</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">L</td>
<td align="right">-24</td>
<td align="right">-53</td>
<td align="right">-9</td>
<td align="left">Vis</td>
<td align="left">L_VentroMedial_Visual_Area_2</td>
<td align="left">rLinG_left</td>
<td align="left">Left Lingual Gyrus</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">L</td>
<td align="right">-24</td>
<td align="right">-76</td>
<td align="right">-13</td>
<td align="left">Vis</td>
<td align="left">L_Eighth_Visual_Area</td>
<td align="left">A37mv_left</td>
<td align="left">Left Fusiform Gyrus</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">L</td>
<td align="right">-43</td>
<td align="right">-70</td>
<td align="right">-9</td>
<td align="left">Vis</td>
<td align="left">L_Area_PH</td>
<td align="left">A37lv_left</td>
<td align="left">Left Inferior Occipital Gyrus</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">L</td>
<td align="right">-10</td>
<td align="right">-66</td>
<td align="right">-5</td>
<td align="left">Vis</td>
<td align="left">L_Third_Visual_Area</td>
<td align="left">rLinG_left</td>
<td align="left">Left Lingual Gyrus</td>
<td align="left">4</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">L</td>
<td align="right">-25</td>
<td align="right">-94</td>
<td align="right">-11</td>
<td align="left">Vis</td>
<td align="left">L_Third_Visual_Area</td>
<td align="left">iOccG_left</td>
<td align="left">Left Inferior Occipital Gyrus</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">L</td>
<td align="right">-14</td>
<td align="right">-44</td>
<td align="right">-3</td>
<td align="left">Vis</td>
<td align="left">L_PreSubiculum</td>
<td align="left">A23v_left</td>
<td align="left">Left Lingual Gyrus</td>
<td align="left">6</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">L</td>
<td align="right">-5</td>
<td align="right">-92</td>
<td align="right">-3</td>
<td align="left">Vis</td>
<td align="left">L_Primary_Visual_Cortex</td>
<td align="left">cCunG_left</td>
<td align="left">Left Calcarine Gyrus</td>
<td align="left">7</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="left">L</td>
<td align="right">-46</td>
<td align="right">-71</td>
<td align="right">8</td>
<td align="left">Vis</td>
<td align="left">L_Medial_Superior_Temporal_Area</td>
<td align="left">V5/MT+_left</td>
<td align="left">Left Middle Occipital Gyrus</td>
<td align="left">8</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="left">L</td>
<td align="right">-23</td>
<td align="right">-96</td>
<td align="right">6</td>
<td align="left">Vis</td>
<td align="left">L_Third_Visual_Area</td>
<td align="left">OPC_left</td>
<td align="left">Left Middle Occipital Gyrus</td>
<td align="left">9</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="left">L</td>
<td align="right">-12</td>
<td align="right">-70</td>
<td align="right">7</td>
<td align="left">Vis</td>
<td align="left">L_Primary_Visual_Cortex</td>
<td align="left">vmPOS_left</td>
<td align="left">Left Calcarine Gyrus</td>
<td align="left">10</td>
</tr>
</tbody>
</table>
<p>The structure of this <code>data.frame</code> is relatively flexible.
The primary requirement is that it contain a column called
<code>value</code> that maps to the numeric value of the corresponding
NIfTI image of interest. Here, we have a column called
<code>roi_num</code> that maps to the integer values in the mask. So, we
need to rename it to <code>value</code> for <code>ggbrain</code> to
accept it as a lookup table for labeling.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schaefer200_atlas_labels</span> <span class="op">&lt;-</span> <span class="va">schaefer200_atlas_labels</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>value <span class="op">=</span> <span class="va">roi_num</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have this, we can add the labels to the corresponding
NIfTI image. This step does not necessarily change the plot, but instead
gives us access to additional columns that we can use for labeling.</p>
<p>We use the <code>labels</code> argument with the <code>images</code>
function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_file</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>atlas <span class="op">=</span> <span class="va">schaefer200_atlas_file</span><span class="op">)</span>, labels<span class="op">=</span><span class="va">schaefer200_atlas_labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"z = 30"</span>, <span class="st">"z=40"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas[atlas &lt; 20]"</span>, name <span class="op">=</span> <span class="st">"Parcel number"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_hue</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in melt.data.table(ll_df, measure.vars = label_columns, variable.name =</span></span>
<span><span class="co">## ".label_col", : 'measure.vars' [hemi, network, MNI_Glasser_HCP_v1.0,</span></span>
<span><span class="co">## Brainnetome_1.0, ...] are not all of the same type. By order of hierarchy, the</span></span>
<span><span class="co">## molten data value column will be of type 'character'. All measure variables not</span></span>
<span><span class="co">## of type 'character' will be coerced too. Check DETAILS in ?melt.data.table for</span></span>
<span><span class="co">## more on coercion.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 4943 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 4972 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Notice that I have broken up the addition of images to the object
into two <code>images</code> steps. This allows for an unambiguous
mapping of the labels to the singular NIfTI. An alternative is to use a
named list of the sort:
<code>images(c(im1=file1, im2=file2), labels=list(im2=im2labels))</code>.</p>
<p>Also, the plot above is identical to our earlier plot. This is
because we have mapped the fill to the numeric value, not another column
in the labels file.</p>
<p>How about we use the labels from the Eickhoff-Zilles macro labels
from N27?</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas[atlas &lt; 20]"</span>, name <span class="op">=</span> <span class="st">"Eickhoff-Zilles Label"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">CA_ML_18_MNI</span><span class="op">)</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_hue</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 4943 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 4972 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Notice how we went from four colors (one per number) in the previous
plot to three labels here. Why did this happen? The labels for the four
regions were not unique in the lookup atlas.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schaefer200_atlas_labels</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">value</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12</span>, <span class="fl">13</span>, <span class="fl">14</span>, <span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="va">value</span>, <span class="va">CA_ML_18_MNI</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   value                  CA_ML_18_MNI</span></span>
<span><span class="co">## 1    12                   Left Cuneus</span></span>
<span><span class="co">## 2    13                   Left Cuneus</span></span>
<span><span class="co">## 3    14 Left Superior Occipital Gyrus</span></span>
<span><span class="co">## 4    18       Left Rolandic Operculum</span></span></code></pre>
<p>This highlights a useful point: there can be a one-to-many mapping
between labels and unique integer values in the NIfTI image. Indeed,
this is often an explicit goal. For example, what if we want to see the
Yeo 7 networks assignments for the nodes on these two slices?</p>
<p>(Note that I’m removing the filter <code>atlas &lt; 20</code> here to
let all of the parcels on these slices get to play.)</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas"</span>, name <span class="op">=</span> <span class="st">"Yeo 7 Assignment"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">network</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 3855 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 3707 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>If we do not provide a color palette using the
<code>fill_scale</code> argument, it defaults to <a href="https://colorbrewer2.org/#type=qualitative&amp;scheme=Set3&amp;n=12" class="external-link">ColorBrewer’s
“Set3”</a>, <code>scale_fill_brewer(palette = "Set3")</code>.</p>
<p>What if we wanted to use the same coloration as in the original Yeo
et al. 2011 paper? These colors are provided in the
Yeo2011_7Networks_ColorLUT.txt file from <a href="https://surfer.nmr.mgh.harvard.edu/fswiki/CorticalParcellation_Yeo2011" class="external-link">Freesurfer</a>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeo_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Yeo2011_7Networks_ColorLUT.txt"</span>, package <span class="op">=</span> <span class="st">"ggbrain"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"index"</span>, <span class="st">"name"</span>, <span class="st">"r"</span>, <span class="st">"g"</span>, <span class="st">"b"</span>, <span class="st">"zero"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">slice</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert RGB to hex. Also, using a named set of colors with scale_fill_manual ensures accurate value -&gt; color mapping</span></span>
<span><span class="va">yeo7</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue_data</a></span><span class="op">(</span><span class="va">yeo_colors</span>, <span class="st">"{sprintf('#%.2x%.2x%.2x', r, g, b)}"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Vis"</span>, <span class="st">"SomMot"</span>, <span class="st">"DorsAttn"</span>, <span class="st">"SalVentAttn"</span>, <span class="st">"Limbic"</span>, <span class="st">"Cont"</span>, <span class="st">"Default"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas"</span>, name <span class="op">=</span> <span class="st">"Yeo 7 Assignment"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">network</span><span class="op">)</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">yeo7</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 3855 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 3707 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="combining-filled-areas-with-outlines">Combining filled areas with outlines<a class="anchor" aria-label="anchor" href="#combining-filled-areas-with-outlines"></a>
</h2>
<p>It may be useful to map some labels to the fill of an area and to
draw outlines around areas using another label. For example, if regions
are nested within networks, we might want to outline the networks with a
certain color while having separate colors for regions.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_outline.html">geom_outline</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"atlas"</span>, name <span class="op">=</span> <span class="st">"Yeo 7 Assignment"</span>, </span>
<span>             mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>outline <span class="op">=</span> <span class="va">network</span><span class="op">)</span>, outline_scale <span class="op">=</span> <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">yeo7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"DAN Region := atlas[atlas.network == 'DorsAttn']"</span>, mapping<span class="op">=</span><span class="fu">aes</span><span class="op">(</span>fill<span class="op">=</span><span class="va">CA_ML_18_MNI</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 29398 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 4911 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 29296 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 4855 rows containing missing values (`geom_raster()`).</span></span></code></pre>
<p><img src="ggbrain_labels_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>This admittedly a busy figure!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Hallquist.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
