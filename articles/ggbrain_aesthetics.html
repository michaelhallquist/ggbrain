<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Aesthetic refinements of ggbrain plots • ggbrain</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Aesthetic refinements of ggbrain plots">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggbrain</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ggbrain_aesthetics.html">Aesthetic refinements of ggbrain plots</a></li>
    <li><a class="dropdown-item" href="../articles/ggbrain_introduction.html">Introduction to ggbrain</a></li>
    <li><a class="dropdown-item" href="../articles/ggbrain_labels.html">Working with annotations and labels in ggbrain</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/michaelhallquist/ggbrain/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Aesthetic refinements of ggbrain plots</h1>
                        <h4 data-toc-skip class="author">Michael
Hallquist</h4>
            
            <h4 data-toc-skip class="date">3 Oct 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/michaelhallquist/ggbrain/blob/main/vignettes/ggbrain_aesthetics.Rmd" class="external-link"><code>vignettes/ggbrain_aesthetics.Rmd</code></a></small>
      <div class="d-none name"><code>ggbrain_aesthetics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="this-is-still-in-progress">This is still in progress<a class="anchor" aria-label="anchor" href="#this-is-still-in-progress"></a>
</h2>
<p>The sections below are incomplete!</p>
</div>
<div class="section level2">
<h2 id="images-that-will-be-used-in-the-demo">Images that will be used in the demo<a class="anchor" aria-label="anchor" href="#images-that-will-be-used-in-the-demo"></a>
</h2>
<p>The package includes a few images that can be used for demonstrating
its capabilities. The locations of the images (and the code to load
them) are listed below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># MNI 2009c anatomical underlay</span></span>
<span><span class="va">underlay_3mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"mni_template_2009c_3mm.nii.gz"</span>, package <span class="op">=</span> <span class="st">"ggbrain"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># onset of decision phase for learning task</span></span>
<span><span class="va">decision_onset_3mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"decision_onset_zstat_3mm.nii.gz"</span>, package <span class="op">=</span> <span class="st">"ggbrain"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Parametric modulator: entropy change following feedback in learning task</span></span>
<span><span class="va">echange_overlay_3mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"echange_overall_zstat_3mm.nii.gz"</span>, package <span class="op">=</span> <span class="st">"ggbrain"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Schaefer 200-parcel atlas of cortex</span></span>
<span><span class="va">schaefer200_atlas_3mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Schaefer_200_7networks_2009c_3mm.nii.gz"</span>, package <span class="op">=</span> <span class="st">"ggbrain"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">underlay_3mm</span>, <span class="va">decision_onset_3mm</span>, <span class="va">echange_overlay_3mm</span>, <span class="va">schaefer200_atlas_3mm</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/home/runner/work/_temp/Library/ggbrain/extdata/mni_template_2009c_3mm.nii.gz"          </span></span>
<span><span class="co">## [2] "/home/runner/work/_temp/Library/ggbrain/extdata/decision_onset_zstat_3mm.nii.gz"        </span></span>
<span><span class="co">## [3] "/home/runner/work/_temp/Library/ggbrain/extdata/echange_overall_zstat_3mm.nii.gz"       </span></span>
<span><span class="co">## [4] "/home/runner/work/_temp/Library/ggbrain/extdata/Schaefer_200_7networks_2009c_3mm.nii.gz"</span></span></code></pre>
<div class="section level3">
<h3 id="converting-to-a-ggplot-object-and-displaying-the-plot">Converting to a ggplot object and displaying the plot<a class="anchor" aria-label="anchor" href="#converting-to-a-ggplot-object-and-displaying-the-plot"></a>
</h3>
<p>For reasons that are somewhat boring (having to do with how R handles
S3 operators like <code>+</code>), the brain-related addition steps for
<code>ggbrain</code> object must come before generic
<code>ggplot2</code> modifications of the plot. More specifically, the
use of the <code>+</code> operator for ggbrain commands like
<code><a href="../reference/geom_brain.html">geom_brain()</a></code> or <code><a href="../reference/images.html">images()</a></code> create and modify an
object that is internal to the</p>
</div>
</div>
<div class="section level2">
<h2 id="adjustments-to-the-appearance-of-image-layers">Adjustments to the appearance of image layers<a class="anchor" aria-label="anchor" href="#adjustments-to-the-appearance-of-image-layers"></a>
</h2>
<div class="section level3">
<h3 id="blur_edge">blur_edge<a class="anchor" aria-label="anchor" href="#blur_edge"></a>
</h3>
</div>
<div class="section level3">
<h3 id="remove_specks">remove_specks<a class="anchor" aria-label="anchor" href="#remove_specks"></a>
</h3>
</div>
<div class="section level3">
<h3 id="trim_threads">trim_threads<a class="anchor" aria-label="anchor" href="#trim_threads"></a>
</h3>
</div>
<div class="section level3">
<h3 id="fill_holes">fill_holes<a class="anchor" aria-label="anchor" href="#fill_holes"></a>
</h3>
<pre><code>  blur_edge = NULL,
  fill_holes = NULL, remove_specks = NULL, trim_threads = NULL)</code></pre>
<div class="section level4">
<h4 id="cleaning-small-specks-from-image-slices">Cleaning small ‘specks’ from image slices<a class="anchor" aria-label="anchor" href="#cleaning-small-specks-from-image-slices"></a>
</h4>
<p>At times, when slicing a given image (esp. functional activations),
it is possible that some clusters are very small, yielding small
‘specks’ on some rendered slices. These are visually unappealing and may
merit removal, depending on your tastes. Of course, removing these
specks can, at the extreme, misrepresent the data, which is undesirable.
This concern notwithstanding, you can use the <code>clean_specks</code>
argument of <code>images</code> to specify the voxel threshold used to
remove clusters smaller than a certain size. For example,
<code>clean_specks = 30</code> would remove any clusters smaller than 30
voxels in size from each slice on the rendered image.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># TODO: make this in geom_brain</span></span>
<span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_obj</span> <span class="op">+</span> <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span>echange<span class="op">=</span><span class="va">echange_overlay_3mm</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filling-small-holes-in-image-slices">Filling small holes in image slices<a class="anchor" aria-label="anchor" href="#filling-small-holes-in-image-slices"></a>
</h4>
<p>Another aesthetic problem is that at times there will be small holes
on the interior of a cluster. These may reflect voxels that fall below a
statistical threshold (e.g., voxels that have a z-statistic value of
3.02 in a cluster defined by z &gt; 3.1). These can be filled in using
the <code>fill_holes</code> argument of <code>images</code>. This
specifies the size of holes (in voxels) that should be filled on the
rendered slices. For example, <code>fill_holes = 30</code> would fill
holes of 30 or fewer voxels on the interior of each cluster. The holes
are filled by nearest neighbor imputation in which the nearest
non-missing voxels are used to impute missing voxels. In
integer-valued/categorical images, the mode of the neighboring voxels is
used for imputation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># TODO: make this in geom_Brain</span></span>
<span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_obj</span> <span class="op">+</span> <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span>echange<span class="op">=</span><span class="va">echange_overlay_3mm</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="labeling-regions">Labeling regions<a class="anchor" aria-label="anchor" href="#labeling-regions"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span>bg_color <span class="op">=</span> <span class="st">"gray60"</span>, text_color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="st">"template_brain.nii.gz"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>dan_clust <span class="op">=</span> <span class="va">dan_clust</span><span class="op">)</span>, fill_holes <span class="op">=</span> <span class="cn">TRUE</span>, clean_specks <span class="op">=</span> <span class="fl">20</span>, labels <span class="op">=</span> <span class="va">dan_labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># slices(paste0("x = ", seq(10, 90, 10), "%")) +</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="../reference/montage.html">montage</a></span><span class="op">(</span><span class="st">"axial"</span>, <span class="fl">10</span>, min <span class="op">=</span> <span class="fl">0.1</span>, max <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># add_slice("y=50%", title = "hello", xlab = "testx", border_size = 1, border_color = "blue") +</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_gradient</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey8"</span>, high <span class="op">=</span> <span class="st">"grey62"</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"dan_clust"</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">label</span><span class="op">)</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_brewer</span><span class="op">(</span><span class="st">"DAN 17 label"</span>, palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_outline.html">geom_outline</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"dan_clust"</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>group <span class="op">=</span> <span class="va">roi_label</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span>, outline <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># fill_scale = scale_fill_discrete("hello"),</span></span>
<span>  <span class="co"># geom_outline(definition = "dan_clust", show_legend = TRUE, mapping=aes(group=label), size=2, outline="cyan") + #fill_scale = scale_fill_discrete("hello"),</span></span>
<span></span>
<span>  <span class="co"># geom_outline(definition = "dan_clust", show_legend = TRUE, outline = "cyan") + #fill_scale = scale_fill_discrete("hello"),</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/geom_region_label_repel.html">geom_region_label_repel</a></span><span class="op">(</span>image <span class="op">=</span> <span class="st">"dan_clust"</span>, label_column <span class="op">=</span> <span class="st">"roi_label"</span>, min.segment.length <span class="op">=</span> <span class="fl">0</span>, size <span class="op">=</span> <span class="fl">1.5</span>, color <span class="op">=</span> <span class="st">"black"</span>, force_pull <span class="op">=</span> <span class="fl">0.2</span>, max.overlaps <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">plot_layout</span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="saving-ggbrain-plots-to-file">Saving ggbrain plots to file<a class="anchor" aria-label="anchor" href="#saving-ggbrain-plots-to-file"></a>
</h2>
</div>
<div class="section level2">
<h2 id="aesthetic-mappings-for">Aesthetic mappings for<a class="anchor" aria-label="anchor" href="#aesthetic-mappings-for"></a>
</h2>
</div>
<div class="section level2">
<h2 id="combining-ggbrain-plots">Combining ggbrain plots<a class="anchor" aria-label="anchor" href="#combining-ggbrain-plots"></a>
</h2>
<p>[Principles of patchwork]</p>
</div>
<div class="section level2">
<h2 id="other-considerations">Other considerations<a class="anchor" aria-label="anchor" href="#other-considerations"></a>
</h2>
<div class="section level4">
<h4 id="resampling-images-to-have-the-same-resolution">Resampling images to have the same resolution<a class="anchor" aria-label="anchor" href="#resampling-images-to-have-the-same-resolution"></a>
</h4>
<p>Oftentimes, higher-resolution images (e.g., 1mm) yield better
graphics since they potentially provide more detail. But fMRI data are
often of lower resolution than T1-weighted images. If you wish to render
your fMRI data on a higher-resolution anatomical template in
<code>ggbrain</code>, you can first use AFNI’s <code>3dresample</code>
command to resample your functional data to match the anatomical
template (underlay).</p>
<p>Here is an example of resampling a 3mm statistic image to a 1mm
underlay using nearest neighbor interpolation. Note that the image to be
resampled should be in the same sterotaxic space as the master/template
image.</p>
<pre><code>3dresample -input echange_overall_zstat_3mm.nii.gz \
  -prefix echange_overall_zstat_1mm.nii.gz \
  -master mni_template_2009c_1mm.nii.gz \
  -rmode NN</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="overview-of-ggbrain">Overview of ggbrain<a class="anchor" aria-label="anchor" href="#overview-of-ggbrain"></a>
</h2>
<p>The <code>ggbrain</code> package uses the <code>ggplot2</code>
package to create 2D volume renderings of NIfTI files containing MRI
data. It seeks to follow the principles of a graphical grammar in which
plots are built from datasets that are mapped onto the visual space via
a set of aesthetic mappings. Likewise, <code>ggbrain</code> follows the
approach of creating layers in which different geometric marks (e.g.,
square pixels) are overlaid on the plot, such that many images and marks
can be combined.</p>
<div class="section level3">
<h3 id="the-hierarchy-of-a-ggbrain-plot">The hierarchy of a ggbrain plot<a class="anchor" aria-label="anchor" href="#the-hierarchy-of-a-ggbrain-plot"></a>
</h3>
<p>Every ggbrain plot is composed of one or more panels that have layers
representing different images that have been overlaid. Each panel
contains a slice along one of the three axes of the volume: x
(Left-Right), y (Anterior-Posterior), or z (Superior-Inferior). Panels
can also contain annotations that reflect one or more marks to aid in
the interpretation of the plot, as well as region labels in which text
is positioned at certain markers within the displayed brain slice.</p>
<ul>
<li>Plot
<ul>
<li>Panels (aka Slices)
<ul>
<li>Layers: each pixel in the 2D slice contains a value such as a test
statistic from a voxelwise analysis. Pixel values can also be
categorical, such as levels of a factor (e.g., lobe).</li>
<li>Annotations: custom text or graphical marks overlaid on the panel
using the ggplot2 <code>annotate</code> function (e.g., coordinate
label)</li>
<li>Region Labels: a variant of ggplot2 <code>geom_text</code>, region
labels represent text that should be overlaid at one or more spatial
positions across the panel/slice (e.g., anatomical labels)</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="question-of-how-to-get-entire-background-to-match-in-color">Question of how to get entire background to match in color<a class="anchor" aria-label="anchor" href="#question-of-how-to-get-entire-background-to-match-in-color"></a>
</h2>
<p>Use bg argument</p>
<pre><code><span><span class="fu">ggsave</span><span class="op">(</span><span class="st">"test.png"</span>, <span class="va">gg_obj</span><span class="op">$</span><span class="fu">render</span><span class="op">(</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">8</span>, height<span class="op">=</span><span class="fl">6</span>, bg<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span><span class="st">"test_dev.pdf"</span>, width<span class="op">=</span><span class="fl">8</span>, height<span class="op">=</span><span class="fl">6</span>, bg<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Michael Hallquist.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
