<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ggbrain">
<title>Introduction to ggbrain • ggbrain</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to ggbrain">
<meta property="og:description" content="ggbrain">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ggbrain</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ggbrain_aesthetics.html">Aesthetic refinements of ggbrain plots</a>
    <a class="dropdown-item" href="../articles/ggbrain_introduction.html">Introduction to ggbrain</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/michaelhallquist/ggbrain/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to ggbrain</h1>
                        <h4 data-toc-skip class="author">Michael Hallquist</h4>
            
            <h4 data-toc-skip class="date">3 Oct 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/michaelhallquist/ggbrain/blob/HEAD/vignettes/ggbrain_introduction.Rmd" class="external-link"><code>vignettes/ggbrain_introduction.Rmd</code></a></small>
      <div class="d-none name"><code>ggbrain_introduction.Rmd</code></div>
    </div>

    
    
<p>This vignette provides an overview of basic usage of the <code>ggbrain</code> package. The package seeks to generate 2D volumetric plots of brain data stored in the NIfTI format. Additional details about the structure of NIfTI data are here: <a href="https://neuroconductor.org/tutorials/nifti_basics" class="external-link uri">https://neuroconductor.org/tutorials/nifti_basics</a>. The <code>ggbrain</code> package uses <code>ggplot2</code> to generate its plots, allowing users to access the wide array of popular features in <code>ggplot2</code>, including annotations and fine control over coloration and themes.</p>
<p>Note that this package is unrelated to the <a href="https://aaronjfisher.github.io/ggBrain-debut.html" class="external-link">ggBrain</a> package developed by Aaron Fisher in 2014. I had developed most of the current <code>ggbrain</code> package and had named it prior to discovering Aaron’s earlier work. The earlier <code>ggBrain</code> package was also not released publicly to CRAN and has not been updated much over the years, whereas <code>ggbrain</code> is hosted on CRAN and also offers a wider array of functionality.</p>
<div class="section level2">
<h2 id="images-that-will-be-used-in-the-demo">Images that will be used in the demo<a class="anchor" aria-label="anchor" href="#images-that-will-be-used-in-the-demo"></a>
</h2>
<p>The package includes a few images that can be used for demonstrating its capabilities. The locations of the images on your machine are listed below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">underlay_3mm</span>, <span class="va">decision_onset_3mm</span>, <span class="va">echange_overlay_3mm</span>, <span class="va">pe_overlay_3mm</span>, <span class="va">abspe_overlay_3mm</span>, <span class="va">schaefer200_atlas_3mm</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/home/runner/work/_temp/Library/ggbrain/extdata/mni_template_2009c_3mm.nii.gz"          </span></span>
<span><span class="co">## [2] "/home/runner/work/_temp/Library/ggbrain/extdata/decision_onset_zstat_3mm.nii.gz"        </span></span>
<span><span class="co">## [3] "/home/runner/work/_temp/Library/ggbrain/extdata/echange_overall_zstat_3mm.nii.gz"       </span></span>
<span><span class="co">## [4] "/home/runner/work/_temp/Library/ggbrain/extdata/pe_ptfce_fwep_0.05.nii.gz"              </span></span>
<span><span class="co">## [5] "/home/runner/work/_temp/Library/ggbrain/extdata/abspe_ptfce_fwep_0.05.nii.gz"           </span></span>
<span><span class="co">## [6] "/home/runner/work/_temp/Library/ggbrain/extdata/Schaefer_200_7networks_2009c_3mm.nii.gz"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="building-a-ggbrain-plot-layer-by-layer">Building a ggbrain plot layer by layer<a class="anchor" aria-label="anchor" href="#building-a-ggbrain-plot-layer-by-layer"></a>
</h2>
<p>One can create an empty ggbrain object using the <code>ggbrain</code> function. This is akin to creating an empty ggplot object using <code>ggplot()</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>At this point, trying to plot the <code>ggbrain</code> yields a warning given that no data or geometric layers have been added.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in self$render(guides): No brain layers added to this object yet. Use +</span></span>
<span><span class="co">## geom_brain() or + geom_outline() to add.</span></span></code></pre>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<p>Consistent with the <code>ggplot2</code> approach, additional elements can be added using the <code>+</code> operator, as we elaborate below. The main thing to know at this point is that <strong>you need to add all ggbrain-specific elements before adding typical ggplot components such as <code>theme()</code></strong>.</p>
<p>Also note that the order of the addition operations for images and slices (<code>images</code> and <code>slices</code>, respectively) is not important. The example order below – adding images, slices, layers, and labels – is conceptually intuitive, but could be reordered without altering the plut. As in <code>ggplot2</code>, the order of all geom_* layers <em>does</em> matter, such that geom_* layers that are added later are rendered on top of layers added earlier. For example, the <code><a href="../reference/geom_brain.html">geom_brain()</a></code> layer for an underlay image should be added before an overlay.</p>
<div class="section level3">
<h3 id="add-images">Add images<a class="anchor" aria-label="anchor" href="#add-images"></a>
</h3>
<p>A ggbrain plot must have at least one 3D image stored in NIfTI format. These images are read into ggbrain using the <code>RNifti</code> package. All images for a given plot must have the same image dimensions (otherwise, an error will occur). At present, <code>ggbrain</code> provides no internal support for interpolation to combine images with different resolutions. We encourage you to use <code>3dresample</code> from AFNI for this purpose (see details in the ‘Other considerations’ section below).</p>
<p>The file names containing relevant images can be passed in as arguments to <code>ggbrain</code> or they can be appended using <code><a href="../reference/images.html">images()</a></code> In either, it is important to provide a name for the image that is used internally to refer to the image in contrasts, labels, or other operations. If you do not provide a name, you will see a warning:</p>
<pre><code>Warning message:
In private$set_images(images, fill_holes, clean_specks) :
  The images vector does not contain any names. This may lead to weird behaviors downstream if 'underlay' and 'overlay' are requested.</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_obj</span> <span class="op">+</span> <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_3mm</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that the image name of ‘underlay’ has a special meaning in the package. Specifically, using this name will set a default color scale that is grayscale and will not show the legend of this scale in the plot. You don’t have to use ‘underlay’ but it can make things a bit simpler if you have a conventional plot that shows an anatomical scan underneath functional activations.</p>
<p>You can add many images at once by providing a named vector:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_3mm</span>, echange <span class="op">=</span> <span class="va">echange_overlay_3mm</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Or you can add many images in independent <code>images</code> steps. Note that the order of addition is not important.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_3mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>echange <span class="op">=</span> <span class="va">echange_overlay_3mm</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-slices">Adding slices<a class="anchor" aria-label="anchor" href="#adding-slices"></a>
</h3>
<p>After adding images to the ggbrain object, the next step is to specify which slices should be displayed on the plot. This is achieved using the <code><a href="../reference/slices.html">slices()</a></code> function. Following standard neuroimaging terminology, we can add axial, sagittal, and coronal slices.</p>
<p>The order of the addition operations, whether within a single <code><a href="../reference/slices.html">slices()</a></code> call or in a sequence of calls like <code>slices("x=12") + slices(c("y=15", "z=10"))</code>, determines the order of panels on the rendered plot from upper left to lower right (following the standard <code>facet_wrap()</code> conventions in ggplot2). Thus, consider the order in which you wish the panels to appear so that the slice additions follow this order.</p>
<div class="section level4">
<h4 id="adding-slices-by-spatial-position">Adding slices by spatial position<a class="anchor" aria-label="anchor" href="#adding-slices-by-spatial-position"></a>
</h4>
<p>The most conventional approach is add slices based on their spatial position along one of three cardinal axes, x/sagittal, y/coronal, or z/axial. You can determine the locations of interest using an interactive image viewer such as afni or fsleyes. Or, as described below, you could add a montage of images, add the coordinate labels on the panels, then choose the coordinates of the slices that are most relevant.</p>
<p>You can add one or more slices using <code><a href="../reference/slices.html">slices()</a></code> by passing a character vector of positions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_obj</span> <span class="op">+</span> <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x = 10"</span>, <span class="st">"y = 70"</span>, <span class="st">"z = 15"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This will add one sagittal slice (x=10), one coronal (y=70), and one axis (z=15).</p>
</div>
<div class="section level4">
<h4 id="adding-slices-by-quantile">Adding slices by quantile<a class="anchor" aria-label="anchor" href="#adding-slices-by-quantile"></a>
</h4>
<p>If you want to use standardized coordinates in terms of percentiles, rather than spatial coordinates, you can append <code>%</code> at the end of the <code><a href="../reference/slices.html">slices()</a></code> specification. This will find the position of the corresponding slice along the axis between 0% and 100%. These percentiles are computed based on the slices that are not entirely empty (i.e., not all zero).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_obj</span> <span class="op">+</span> <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x = 25%"</span>, <span class="st">"y = 50%"</span>, <span class="st">"z = 90%"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adding-slices-with-additional-aesthetic-details">Adding slices with additional aesthetic details<a class="anchor" aria-label="anchor" href="#adding-slices-with-additional-aesthetic-details"></a>
</h4>
<p>If you would like to alter specific aesthetic elements of the slices such as the panel title, border, or axis labels, these can be added as arguments to <code><a href="../reference/slices.html">slices()</a></code>. Aesthetic arguments that will alter the appearance of the relevant slices include:</p>
<ul>
<li>
<code>title</code>: The panel title</li>
<li>
<code>bg_color</code>: The background color of the panel</li>
<li>
<code>text_color</code>: The color of text on the panel</li>
<li>
<code>border_color</code>: The color of a border around the panel</li>
<li>
<code>border_size</code>: The size (thickness) of the border around the panel. Default is NULL (none).</li>
<li>
<code>xlab</code>: The x axis label of the panel</li>
<li>
<code>ylab</code>: The y axis label of the panel</li>
<li>
<code>theme_custom</code>: A ggplot2 <code>theme()</code> (or list of theme calls) added to this panel that customizes its appearance.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_obj</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x = 25%"</span>, <span class="st">"x = 50%"</span><span class="op">)</span>,</span>
<span>    bg_color <span class="op">=</span> <span class="st">"gray25"</span>, xlab <span class="op">=</span> <span class="st">"x axis"</span>, theme_custom <span class="op">=</span> <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adding-montages">Adding montages<a class="anchor" aria-label="anchor" href="#adding-montages"></a>
</h4>
<p>If you would like a set of slices along one of the image planes to form a montage, you can use the <code><a href="../reference/montage.html">montage()</a></code> convenience function to specify the inputs to <code><a href="../reference/slices.html">slices()</a></code>. The arguments are</p>
<ul>
<li>
<code>plane</code>: “sagittal”, “coronal”, or “axial” (“x”, “y”, and “z” also work)</li>
<li>
<code>n</code>: the number of slices to render along this plane</li>
<li>
<code>min</code>: the lowest quantile to be included (between 0 and 1). Default: 0.1</li>
<li>
<code>max</code>: the highest quantile to be included (between 0 and 1). Default: 0.9</li>
<li>
<code>min_coord</code>: the lowest spatial position to be included. Mutually exclusive with quantile approach. Default: NULL</li>
<li>
<code>max_coord</code>: the highest spatial position to be included. Mutually exclusive with quantile approach. Default: NULL</li>
</ul>
<p>The code below adds 10 axial slices between the 10th and 90th percentiles.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_obj</span> <span class="op">+</span> <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="../reference/montage.html">montage</a></span><span class="op">(</span><span class="st">"axial"</span>, <span class="fl">10</span>, min <span class="op">=</span> <span class="fl">0.1</span>, max <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This code adds 5 sagittal slices between the x = -10 and x = 10 (millimeters, in image coordinates).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_obj</span> <span class="op">+</span> <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="../reference/montage.html">montage</a></span><span class="op">(</span><span class="st">"sagittal"</span>, <span class="fl">5</span>, min_coord <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, max_coord <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="adding-brain-overlay-layers-to-a-plot">Adding brain overlay layers to a plot<a class="anchor" aria-label="anchor" href="#adding-brain-overlay-layers-to-a-plot"></a>
</h3>
<p>Now that we have defined the images to read and the slices to render, we need to map the numeric values in the slices to the points on the plot. This is achieved by <code><a href="../reference/geom_brain.html">geom_brain()</a></code>, which is essentially an extension of <code>geom_raster()</code> from <code>ggplot2</code>. The numeric values in the slices fill squares on the plot, essentially forming ‘pixels’.</p>
<p>As with standard <code>ggplot2</code> objects, the fill color of these pixels is determined by a <code>scale_fill_*</code> scale, allowing you to have fine control over the coloration.</p>
<p>Extending <code>geom_raster()</code>, the <code><a href="../reference/geom_brain.html">geom_brain()</a></code> layer supports the following standards:</p>
<ul>
<li>
<code>interpolate</code>: if TRUE, <code>geom_raster</code> smooths the layer, rather than rendering discrete squares.</li>
<li>
<code>alpha</code>: A number between 0 and 1 controlling the alpha transparency of the layer</li>
<li>
<code>show_legend</code>: If TRUE (default), a legend mapping the numeric values to a color scale is included in the panel</li>
<li>
<code>fill</code>: A color to be used to fill all non-NA pixels. In ggplot2 terms, this is ‘setting’ the color of all pixels, as opposed to ‘mapping’ the color to the numeric value via a scale.</li>
<li>
<code>mapping</code>: The aesthetic mapping between the data and the raster layer. In general, the default of <code>aes(fill=value)</code> should be retained for parametric layers (i.e., where the color of pixels should map to a continuous scale). But as detailed in a subsequent section, the fill can mapped to label columns in a categorical image (e.g., atlas).</li>
</ul>
<p>Relative to standard ggplot2 conventions, the use of <code><a href="../reference/geom_brain.html">geom_brain()</a></code> requires that you specify details about the fill color scale when the layer is added. This results from the fact that <code>ggbrain</code> objects re-use the ‘fill’ geometry when layers are overlaid. For example, if you have an anatomical underlay with a grayscale fill and a statistical overlay with a color fill, each layer needs to have its own fill scale (with a <code>scale_fill_*</code> object). This is achieved internally using the <code>ggnewscale</code> package.</p>
<p>The ‘take-home message’ is that you need to specify fill scale information as part of the <code><a href="../reference/geom_brain.html">geom_brain()</a></code> call. Here are the key arguments:</p>
<ul>
<li>
<code>limits</code>: a two-element vector that if provided, sets the upper and lower bounds on the scale</li>
<li>
<code>breaks</code>: a function to draw the breaks on the scale. The default is <code><a href="../reference/integer_breaks.html">integer_breaks()</a></code>, which draws a few integer-valued breaks (usually, 5) between the min and max of the scale.</li>
<li>
<code>unify_scale</code>: if TRUE (default), the color scale across panels (slices) will be equated. If FALSE, each panel will apply the color scale independently such that the min and max are slice-dependent.</li>
<li>
<code>fill_scale</code>: a <code>scale_fill_*</code> object use for mapping the numeric values in the data to the fill channel on the plot. Standard scales such as <code>scale_fill_viridis_c()</code> can be used for continuous layers. Note that the package also provides a <code><a href="../reference/scale_fill_bisided.html">scale_fill_bisided()</a></code> option that, if added, creates separate color scales for the positive and negative pixels on the plot. This is a conventional approach in displays of fMRI activation maps where, for example, positive modulation is mapped to warm colors (reds) while negative modulation is mapped to cool colors (blues). Note that <code><a href="../reference/scale_fill_bisided.html">scale_fill_bisided()</a></code> has arguments of <code>neg_scale</code> and <code>pos_scale</code> that allow the scales used for negative and positive values, respectively, to be specified directly.</li>
</ul>
<div class="section level4">
<h4 id="defining-an-image-layer">Defining an image layer<a class="anchor" aria-label="anchor" href="#defining-an-image-layer"></a>
</h4>
<p>The <code><a href="../reference/geom_brain.html">geom_brain()</a></code> function includes an argument called <code>definition</code>. This controls the numeric values that are selected for display on the layer. The simplest definition is to name the image to be displayed. Recall that when you use <code><a href="../reference/images.html">images()</a></code>, you provide names for the images. These are used as a reference by <code>ggbrain</code> to interpret your layer definitions.</p>
<p>For example, here I want to render the underlay and overlay layers with their numeric values:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a reusable object that has the same images and slices</span></span>
<span><span class="va">gg_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span>bg_color <span class="op">=</span> <span class="st">"gray80"</span>, text_color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_3mm</span>, overlay <span class="op">=</span> <span class="va">echange_overlay_3mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x = 10"</span>, <span class="st">"y = 70"</span>, <span class="st">"z = 15"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_gradient</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey8"</span>, high <span class="op">=</span> <span class="st">"grey62"</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"overlay"</span>, fill_scale <span class="op">=</span> <span class="fu"><a href="../reference/scale_fill_bisided.html">scale_fill_bisided</a></span><span class="op">(</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Now that we have <code>geom_*</code> layers in our <code>ggbrain</code> object, we can finally plot our figure to see the result.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span><span class="op">$</span><span class="fu">render</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">plot_annotation</span><span class="op">(</span>theme <span class="op">=</span> <span class="fu">theme</span><span class="op">(</span>plot.background <span class="op">=</span> <span class="fu">element_rect</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"blue"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggbrain_introduction_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="defining-subset-layers">Defining subset layers<a class="anchor" aria-label="anchor" href="#defining-subset-layers"></a>
</h4>
<p>Oftentimes, we wish to modify the display by selecting a subset of values to display. One of the most common applications is thresholding of voxelwise statistics so that small/nonsignificant values are omitted. To achieve this, <code><a href="../reference/geom_brain.html">geom_brain()</a></code> supports standard subsetting syntax used in R. Here is an example of thresholding the overlay layer so that the absolute (z) statistic is above 2.5:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"overlay[abs(overlay) &gt; 2.5]"</span>, fill_scale <span class="op">=</span> <span class="fu"><a href="../reference/scale_fill_bisided.html">scale_fill_bisided</a></span><span class="op">(</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggbrain_introduction_files/figure-html/unnamed-chunk-15-1.png" width="768"></p>
<p>Note how ‘overlay’ is treated as an R object that is subset using square brackets. The subsetting expression inside the brackets uses standard R syntax and can reference other images currently in the ggbrain object. For example, you could display overlay values only where the underlay is greater than 10:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"overlay[underlay &gt; 10]"</span>, fill_scale <span class="op">=</span> <span class="fu"><a href="../reference/scale_fill_bisided.html">scale_fill_bisided</a></span><span class="op">(</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggbrain_introduction_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>Finally, note that one can combine subsetting expressions using logical operators <code>&amp;</code> and <code>|</code> , as in standard R syntax for vector operations. For example, here’s how you could include pixels where <code>abs(overlay) &gt; 2.5</code> and <code>underlay &gt; 20</code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="va">gg_base</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span></span>
<span>    definition <span class="op">=</span> <span class="st">"overlay[abs(overlay) &gt; 2.5 &amp; underlay &gt; 20]"</span>,</span>
<span>    fill_scale <span class="op">=</span> <span class="fu"><a href="../reference/scale_fill_bisided.html">scale_fill_bisided</a></span><span class="op">(</span><span class="st">"z"</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggbrain_introduction_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="defining-a-contrast-layer">Defining a contrast layer<a class="anchor" aria-label="anchor" href="#defining-a-contrast-layer"></a>
</h4>
<p>The <code>ggbrain</code> package also supports full contrasts in which images can be added, subtracted, multiplied, or divided. For example, one might wish to see the difference between one activation map and another. Of course, many such contrasts can be computed in the GLM estimation, but it is often useful to compute certain contrasts after the fact.</p>
<p>For example, what if we have signed and absolute reward prediction error maps from a simple reinforcement learning paradigm? We might be interested to look at areas that are more strongly modulated by signed than absolute PEs.</p>
<p>These contrasts can either be defined inline within the <code>definition</code> field of <code>geom_brain</code> or <code>geom_outline</code>. Or, they can be added to the <code>ggbrain</code> object in advance using the <code><a href="../reference/define.html">define()</a></code> function.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span>bg_color <span class="op">=</span> <span class="st">"gray80"</span>, text_color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_3mm</span>, pe <span class="op">=</span> <span class="va">pe_overlay_3mm</span>, abspe <span class="op">=</span> <span class="va">abspe_overlay_3mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x = 10"</span>, <span class="st">"y = 50"</span>, <span class="st">"z = 15"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/define.html">define</a></span><span class="op">(</span><span class="st">"diff := pe - abspe"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"diff"</span>, fill_scale <span class="op">=</span> <span class="fu"><a href="../reference/scale_fill_bisided.html">scale_fill_bisided</a></span><span class="op">(</span>symmetric <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggbrain_introduction_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>An equivalent plot would be achieved by including the definition inline:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span>bg_color <span class="op">=</span> <span class="st">"gray80"</span>, text_color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_3mm</span>, pe <span class="op">=</span> <span class="va">pe_overlay_3mm</span>, abspe <span class="op">=</span> <span class="va">abspe_overlay_3mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x = 10"</span>, <span class="st">"y = 50"</span>, <span class="st">"z = 15"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"diff := pe - abspe"</span>, fill_scale <span class="op">=</span> <span class="fu"><a href="../reference/scale_fill_bisided.html">scale_fill_bisided</a></span><span class="op">(</span>symmetric <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The advantage of <code><a href="../reference/define.html">define()</a></code> is that you can re-use and modify contrasts in multiple layers. Here, we subset the difference to only voxels where the PE - abs(PE) contrast is strongly in favor of signed PEs (i.e., positive difference in the z-statistic &gt; 3).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span>bg_color <span class="op">=</span> <span class="st">"gray80"</span>, text_color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_3mm</span>, pe <span class="op">=</span> <span class="va">pe_overlay_3mm</span>, abspe <span class="op">=</span> <span class="va">abspe_overlay_3mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x = 10"</span>, <span class="st">"y = 50"</span>, <span class="st">"z = 15"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/define.html">define</a></span><span class="op">(</span><span class="st">"diff := pe - abspe"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"diff[diff &gt; 3]"</span>, fill_scale <span class="op">=</span> <span class="fu">scale_fill_distiller</span><span class="op">(</span><span class="st">"PE &gt; absPE"</span>, palette<span class="op">=</span><span class="st">"Reds"</span><span class="op">)</span>, show_legend <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggbrain_introduction_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="adding-outlines">Adding outlines<a class="anchor" aria-label="anchor" href="#adding-outlines"></a>
</h3>
<p>In addition to filling in regions with colors, brain plots often benefit from being able to outline, rather than fill, regions. This is accomplished using <code><a href="../reference/geom_outline.html">geom_outline()</a></code>. This geometry finds the boundaries of distinct clusters in the image/contrast and traces the boundaries with a line of some thickness (controlled by <code>size</code>).</p>
<p>For continuous images (e.g., z-statistics), one typically <em>sets</em> the outline color using <code>geom_outline(outline="cyan")</code> or whatever color is desired. This draws the outlines for non-NA voxels in a single color. For categorical images (e.g., anatomical or functional atlases), it may be useful to map the color of the outlines to a categorical label such as network or region. This is accomplished with <code>geom_outline(mapping=aes(outline=roi_name))</code> or whatever column in the data corresponds to the categories one wishes to draw with different colors.</p>
<p>Here, we might wish to outline voxels whose z-statistics exceed <span class="math inline">\(|z| &gt; 3\)</span> for the decision onset regressor. These voxels represent areas that are sensitive to the onset of the decision phase of the reinforcement learning trial.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x = -2"</span>, <span class="st">"x=2"</span>, <span class="st">"y = 40"</span>, <span class="st">"z = 15"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_3mm</span>, onset <span class="op">=</span> <span class="va">decision_onset_3mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_outline.html">geom_outline</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"onset[abs(onset) &gt; 3]"</span>, size <span class="op">=</span> <span class="fl">1</span>, outline <span class="op">=</span> <span class="st">"cyan"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggbrain_introduction_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="converting-to-a-ggplot-object-and-displaying-the-plot">Converting to a ggplot object and displaying the plot<a class="anchor" aria-label="anchor" href="#converting-to-a-ggplot-object-and-displaying-the-plot"></a>
</h3>
<p>For reasons that are somewhat boring (having to do with how R handles S3 operators like <code>+</code>), the brain-related addition steps for <code>ggbrain</code> object must come before generic <code>ggplot2</code> modifications of the plot. For your <code>ggbrain</code> object to be a <code>ggplot</code> object, it must be <em>rendered</em> using the <code><a href="../reference/render.html">render()</a></code> function. This function compiles the images, layers, and slices into the requested plot and returns it as a <code>patchwork</code> object. The patchwork package is extremely useful for combining ggplot objects in different layouts. More details can be found here: <a href="https://patchwork.data-imaginist.com" class="external-link uri">https://patchwork.data-imaginist.com</a>.</p>
<p>In <code>ggbrain</code>, each panel is <code>ggplot</code> object and the panels are composited using <code>wrap_plots</code> in patchwork.</p>
<p>The key message here is: place ggbrain-specific additions <em>before</em> <code><a href="../reference/render.html">render()</a></code> and ggplot-specific additions <em>afterwards</em>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># without a render step</span></span>
<span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x = -2"</span>, <span class="st">"x=2"</span>, <span class="st">"y = 40"</span>, <span class="st">"z = 15"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_3mm</span>, onset <span class="op">=</span> <span class="va">decision_onset_3mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition<span class="op">=</span><span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_outline.html">geom_outline</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"onset[abs(onset) &gt; 3]"</span>, size<span class="op">=</span><span class="fl">1</span>, outline<span class="op">=</span><span class="st">"cyan"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "ggb" "R6"</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note the different class after render</span></span>
<span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x = -2"</span>, <span class="st">"x=2"</span>, <span class="st">"y = 40"</span>, <span class="st">"z = 15"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_3mm</span>, onset <span class="op">=</span> <span class="va">decision_onset_3mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition<span class="op">=</span><span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_outline.html">geom_outline</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"onset[abs(onset) &gt; 3]"</span>, size<span class="op">=</span><span class="fl">1</span>, outline<span class="op">=</span><span class="st">"cyan"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/render.html">render</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "patchwork" "gg"        "ggplot"</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add a different theme to all panels and add an overall title</span></span>
<span><span class="va">gg_obj</span> <span class="op">+</span> <span class="fu">plot_annotation</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Overall title"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggbrain_introduction_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Note, however, that you don’t necessarily need to use <code><a href="../reference/render.html">render()</a></code> at all. When you call <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> on a ggbrain object, the render happens automatically behind the scenes, allowing calls like:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ggbrain.html">ggbrain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/slices.html">slices</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x = -2"</span>, <span class="st">"x=2"</span>, <span class="st">"y = 40"</span>, <span class="st">"z = 15"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/images.html">images</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>underlay <span class="op">=</span> <span class="va">underlay_3mm</span>, onset <span class="op">=</span> <span class="va">decision_onset_3mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_brain.html">geom_brain</a></span><span class="op">(</span>definition<span class="op">=</span><span class="st">"underlay"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_outline.html">geom_outline</a></span><span class="op">(</span>definition <span class="op">=</span> <span class="st">"onset[abs(onset) &gt; 3]"</span>, size<span class="op">=</span><span class="fl">1</span>, outline<span class="op">=</span><span class="st">"cyan"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span> <span class="op">+</span> <span class="fu">plot_annotation</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Overall"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ggbrain_introduction_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>Another point is that by keeping your plots as <code>ggbrain</code> object – that is not adding <code><a href="../reference/render.html">render()</a></code> – you can continue to add brain-related calls like <code><a href="../reference/geom_brain.html">geom_brain()</a></code> or <code><a href="../reference/annotate_coordinates.html">annotate_coordinates()</a></code> to them. Thus, you may wish to use the <code>plot(gg_obj) + [ggplot2 stuff here]</code> approach above so that the <code>ggbrain</code></p>
</div>
</div>
<div class="section level2">
<h2 id="saving-ggbrain-plots-to-file">Saving ggbrain plots to file<a class="anchor" aria-label="anchor" href="#saving-ggbrain-plots-to-file"></a>
</h2>
<p>After you see your beautiful brain plot on the screen, you may soon wish to have it as an image file for publications or presentation. As with standard ggplot objects, you can use <code>ggsave()</code> or the usual graphics device (e.g., <code>pdf</code>) and <code><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off()</a></code> approach from base R.</p>
<p>Note that if you pass a <code>ggbrain</code> object directly to <code>ggsave</code>, it will complain that the plot is not a ggplot object. We can just pass a rendered version like so:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggsave</span><span class="op">(</span>filename<span class="op">=</span><span class="st">"my_brain_plot.pdf"</span>, <span class="va">gg_obj</span><span class="op">$</span><span class="fu">render</span><span class="op">(</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">15</span>, height<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span><span class="st">"my_brain_plot_2.pdf"</span>, width<span class="op">=</span><span class="fl">10</span>, height<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_obj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## agg_png </span></span>
<span><span class="co">##       2</span></span></code></pre>
<p>Like with standard <code>ggplot</code>, one of the beautiful aspects of saving files in vector formats such as PDF is that you can open and edit the elements of the plot using vector editors like Adobe Illustrator or Inkscape!</p>
<p>One small note: some PDF viewers will automatically interpolate the ‘raster’ parts of a PDF, leading the image to look blurry even though it isn’t really so. I have seen this in recent version of Apple Preview (which is otherwise a nice piece of software). Thus, if you want to see precisely how your PDFs look coming out of <code>ggbrain</code>, I would suggest opening them in Adobe Acrobat Viewer.</p>
</div>
<div class="section level2">
<h2 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>Now that you understand the basics of <code>ggbrain</code> plots, I encourage you to read the <a href="ggbrain_aesthetics.html">ggbrain aesthetics</a> vignette, which provides more detailed guidance about how to clean up the appearance of brain displays and to add more complex annotations.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Michael Hallquist.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
